!function(){function t(e,i,r){function n(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=i[s]={exports:{}};e[s][0].call(p.exports,function(t){var i=e[s][1][t];return n(i||t)},p,p.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}return t}()({1:[function(t,e,i){"use strict";function r(t,e,i){return new n(t,e,i)}function n(t,e,i){this.dstCont=t,this.dstPos=e,this.dropType=i,this.sameAs=function(t){return this.dstCont===t.dstCont&&this.dstPos===t.dstPos&&this.dropType===t.dropType}}e.exports=r},{}],2:[function(t,e,i){"use strict";function r(t){return t.constructor===n?t:new n(t)}function n(t){var e,i,r;if(t instanceof Array)throw"A Raphael element is required";if(this.element=t,this.cx=0,this.cy=0,this.opacity=1,e=this.paper=t.paper,i=e.raphael.el.constructor,e.raphael.vml?(this.vml=!0,r=document.createElement("group"),r.style.position="absolute"):(this.vml=!1,r=document.createElementNS("http://www.w3.org/2000/svg","g")),e.canvas.appendChild(r),this.group=new i(r,e),this.vml){var n=this;this.group.transform=function(t){return"undefined"==typeof t?[["t",n.cx,n.cy]]:1===t.length&&"t"===t[0][0]?void n.placeAt(t[0][1],t[0][2]):void alert("unsupported VML group transform")}}this.addElement(t)}var o=t("./utils");e.exports=r,n.prototype.addElement=function(t){if("set"===t.type)for(var e=0,i=t.length;e<i;e++)this.addElement(t[e]);else if(this.group.node.appendChild(t.node),!this.vml&&"text"===t.type){var r=t.getBBox(),n=this.paper.rect(r.x,r.y,r.width,r.height).attr("fill","red").attr("opacity",0);this.group.node.appendChild(n.node)}},n.prototype.clone=function(){var t=new n(this.element.clone());return t.placeAt(this.cx,this.cy),t},n.prototype.placeAt=function(t,e){return this.cx=t,this.cy=e,this.vml?(this.group.node.style.left=t+"px",this.group.node.style.top=e+"px"):this.group.transform("t"+t+","+e),this},n.prototype.placeAtWithAnim=function(t,e,i){return this.cx=t,this.cy=e,this.group.animate({transform:"t"+t+","+e},i,""),this},n.prototype.remove=function(){this.group.remove()},n.prototype.show=function(){return 1!==this.opacity&&(this.group.attr("opacity",1),this.opacity=1),this.group.show(),this},n.prototype.hide=function(){return this.group.hide(),this},n.prototype.halfHide=function(){return this.group.attr("opacity",.3),this.opacity=.3,this},n.prototype.drag=function(t,e,i,r){return Beav.dragWithTouch(this.group,t,e,i,r),this},n.prototype.undrag=function(){return this.group.undrag(),this},n.prototype.toFront=function(){return this.group.toFront(),this},o.ie6&&(n.prototype.placeAtWithAnim=n.prototype.placeAt)},{"./utils":7}],3:[function(t,e,i){"use strict";function r(t,e){var i=t.paper;if(c(e.ident)&&(e.ident=""),c(e.type)&&(e.type="list"),p(e.type,["source","list"])&&alert("type should be 'source' or 'list'"),(c(e.cx)||c(e.cy))&&alert("cx and cy are not specified"),c(e.widthPlace)&&(e.widthPlace=40),c(e.heightPlace)&&(e.heightPlace=40),c(e.align)?c(e.direction)?(e.direction="horizontal",e.align="left"):"vertical"===e.direction?e.align="top":"horizontal"===e.direction?e.align="left":alert("direction should be 'vertical' or 'horizontal' "):(p(e.align,["top","bottom","left","right"])&&alert("align should be 'top' or 'bottom' or 'left' or 'right'"),"top"===e.align||"bottom"===e.align?e.direction="vertical":e.direction="horizontal"),c(e.dragDisplayMode)?e.dragDisplayMode="preview":p(e.dragDisplayMode,["preview","marker"])&&alert("dragDisplayMode should be 'preview' or 'marker' "),c(e.placeBackgroundArray)){var r=e.widthPlace,o=e.heightPlace;e.placeBackgroundArray=[i.rect(-r/2,-o/2,r,o).attr("fill","blue")]}return"source"===e.type&&(c(e.dropMode)&&(e.dropMode="replace"),e.nbPlaces=1,c(e.sourceElemArray)&&alert("sourceElemArray should be defined"),e.sourceElemArray instanceof Array&&(e.sourceElemArray=i.set(e.sourceElemArray))),"list"===e.type&&(c(e.dropMode)&&(e.dropMode="insert"),c(e.nbPlaces)&&(e.nbPlaces=5)),new n(t,e.ident,e.cx,e.cy,e.nbPlaces,e.widthPlace,e.heightPlace,e.direction,e.align,e.dropMode,e.dragDisplayMode,e.placeBackgroundArray,e.type,e.sourceElemArray,e.places)}function n(t,e,i,r,n,o,a,l,c,p,h,d,u,f,g){if(this.dragAndDropSystem=t,this.ident=e,this.cx=i,this.cy=r,this.nbPlaces=n,this.widthPlace=o,this.heightPlace=a,this.direction=l,this.align=c,this.dropMode=p,this.dragDisplayMode=h,this.type=u,this.places=g,this.sanityCheck(),this.placeHolder=s(t.paper.rect(-o/2,-a/2,o,a).attr({stroke:"yellow","stroke-width":"2","stroke-dasharray":"-"})),this.placeHolder.hide(),this.indicator=null,d){for(var y=t.paper.set(d),m=0;m<this.nbPlaces;m++){var v=this.placeCenter(m);s(y.clone()).placeAt(v[0],v[1])}y.hide()}this.draggableElements=[];for(var b=0;b<this.nbPlaces;b++)this.draggableElements[b]=null;if("source"===this.type&&f){var A=this.placeCenter(0);this.sourceComponent=s(f),window.sourceComponents=window.sourceComponents||[],window.sourceComponents.push(this.sourceComponent),this.sourceComponent.placeAt(A[0],A[1]);var P=this.updateSource();this.sourceComponent.draggable=P}this.timeAnim=100}var o=t("./utils"),s=t("./component"),a=t("./draggable_element"),l=t("./action"),c=o.isUndefined,p=o.notIn;e.exports=r,n.prototype.sanityCheck=function(){p(this.direction,["vertical","horizontal"])&&alert("direction should be 'vertical' or 'horizontal'!"),"vertical"===this.direction&&p(this.align,["top","bottom"])&&alert("Since direction is vertical, align should be 'top' or 'bottom'"),"horizontal"===this.direction&&p(this.align,["left","right"])&&alert("Since direction is horizontal, align should be 'left' or 'right'"),p(this.dropMode,["replace","insert-replace","insert","insertBefore"])&&alert("dropMode should be 'replace' or 'insert' or 'insert-replace' or 'insertBefore'"),p(this.dragDisplayMode,["preview","marker"])&&alert("dragDisplayMode should be 'preview' or 'marker' "),p(this.type,["list","source"])&&alert("type should be 'list' or 'source'")},n.prototype.placeCenter=function(t){var e=this.widthPlace,i=this.heightPlace;return c(this.places)?"horizontal"===this.direction?"left"===this.align?[this.cx+(2*t+1-this.nbPlaces)*e/2,this.cy]:[this.cx+(this.nbPlaces-2*t-1)*e/2,this.cy]:"top"===this.align?[this.cx,this.cy+(2*t+1-this.nbPlaces)*i/2]:[this.cx,this.cy+(this.nbPlaces-2*t-1)*i/2]:this.places[t]},n.prototype.placeId=function(t,e){for(var i=0;i<this.nbPlaces;i++){var r=this.placeCenter(i),n=this.widthPlace,o=this.heightPlace;if(t>=r[0]-n/2&&t<=r[0]+n/2&&e>=r[1]-o/2&&e<=r[1]+o/2)return i}return-1},n.prototype.isInContainer=function(t,e){return this.placeId(t,e)!==-1},n.prototype.ratioPositionInPlace=function(t,e){var i=this.placeCenter(0),r=this.placeCenter(1),n=[t-i[0],e-i[1]],o=[r[0]-i[0],r[1]-i[1]],s=n[0]*o[0]+n[1]*o[1],a=parseFloat(s)/parseFloat(o[0]*o[0]+o[1]*o[1])+.5;return a-this.placeId(t,e)},n.prototype.getCorrespondingAction=function(t,e,i){var r=this.placeId(e,i),n=this.ratioPositionInPlace(e,i);return r===-1?null:"replace"===this.dropMode?l(this,r,"replace"):"insert-replace"===this.dropMode?n<.25?l(this,r,"insert"):n>.75&&r+1<this.nbPlaces?l(this,r+1,"insert"):l(this,r,"replace"):"insert"===this.dropMode?n<.25?l(this,r,"insert"):n>.75&&r+1<this.nbPlaces?l(this,r+1,"insert"):null:"insertBefore"===this.dropMode?n<.75?l(this,r,"insert"):n>.75&&r+1<this.nbPlaces?l(this,r+1,"insert"):null:void alert("dropMode ?")},n.prototype.getElementsAfterDrop=function(t,e,i,r,n){for(var o=[],s=0;s<this.nbPlaces;s++)o[s]=this.draggableElements[s];if(o[this.nbPlaces]=null,this===t)if("replace"===this.dropMode)o[e]=null;else for(s=e;s+1<=this.nbPlaces&&null!==this.draggableElements[s];)o[s]=o[s+1],s++;var a=t.draggableElements[e];if(this===i)if("replace"===n)o[r]=a;else{for(var l=r;l<this.nbPlaces&&null!==o[l];)l++;for(s=l;s>r;s--)o[s]=o[s-1];o[r]=a}return o},n.prototype.createAt=function(t,e,i){if(this.draggableElements[t])throw"a draggable element at index "+t+" already exists in container "+this.ident;i instanceof Array&&(i=this.dragAndDropSystem.paper.set(i));var r=new a(this,t,e,i);this.draggableElements[t]=r;var n=this.placeCenter(t);return r.placeAt(n[0],n[1]),r},n.prototype.clearPlace=function(t){var e=this.draggableElements[t];this.draggableElements[t]=null,e.remove()},n.prototype.clear=function(){for(var t=this.draggableElements,e=0;e<t.length;e++){var i=t[e];null!==i&&(t[e]=null,i.remove())}},n.prototype.getObjects=function(){for(var t=[],e=0;e<this.nbPlaces;e++){var i=this.draggableElements[e];t.push(i&&i.ident)}return t},n.prototype.setObjects=function(t){for(var e=0;e<this.nbPlaces;e++){var i=t[e];this.draggableElements[e]=i,null!==i&&(i.container=this,i.iPlace=e)}},n.prototype.getElementOver=function(t,e,i){for(var r=0;r<this.nbPlaces;r++){var n=this.draggableElements[r];if(null!==n&&n!==t&&e>=n.component.cx-this.widthPlace/2-1&&e<=n.component.cx+this.widthPlace/2+1&&i>=n.component.cy-this.heightPlace/2-1&&i<=n.component.cy+this.heightPlace/2+1)return n}return null},n.prototype.showIndicator=function(t){if("marker"==this.dragDisplayMode){var e=this.dragAndDropSystem.paper,i=this.placeCenter(t.dstPos),r=this.widthPlace,n=this.heightPlace;if("replace"===t.dropType&&(this.indicator=e.rect(i[0]-r/2,i[1]-n/2,r,n).attr({stroke:"red","stroke-width":"4"})),"insert"===t.dropType){var o=this.placeCenter(t.dstPos-1);if("vertical"===this.direction){var s=(o[1]+i[1])/2;this.indicator=e.rect(i[0]-3*r/4,s,3*r/2,1).attr({stroke:"red","stroke-width":"4"})}else{var a=(o[0]+i[0])/2;this.indicator=e.rect(a,i[1]-3*n/4,1,3*n/2).attr({stroke:"red","stroke-width":"4"})}}}},n.prototype.hideIndicator=function(){null!==this.indicator&&this.indicator.remove(),this.indicator=null},n.prototype.updateSource=function(){if("source"===this.type&&null===this.draggableElements[0]){var t=this.sourceComponent.clone();return this.createAt(0,this.ident,t)}},n.prototype.updateDisplay=function(){this.updateSource(),this.placeHolder.hide();for(var t=0;t<this.draggableElements.length;t++){var e=this.draggableElements[t];if(null!==e){var i=this.placeCenter(t);e.component.placeAtWithAnim(i[0],i[1],this.timeAnim),e.component.show()}}},n.prototype.updateIntermediateDisplay=function(t,e,i,r,n){this.placeHolder.hide();var o,s,a=this.getElementsAfterDrop(t,e,i,r,n);if("preview"===this.dragDisplayMode)for(o=0;o<=this.nbPlaces;o++)s=this.placeCenter(o),null!==a[o]&&(a[o]===t.draggableElements[e]?(this.placeHolder.show(),this.placeHolder.placeAt(s[0],s[1]),this.placeHolder.toFront(),t.draggableElements[e].show(),t.draggableElements[e].toFront()):(a[o].component.placeAtWithAnim(s[0],s[1],this.timeAnim),a[o].show()));if("marker"===this.dragDisplayMode){if("replace"===this.dropMode)return;for(o=0;o<this.nbPlaces;o++)null!==this.draggableElements[o]&&this.draggableElements[o].show();if(this===t)for(var l=e;l+1<this.nbPlaces&&null!==this.draggableElements[l+1];)s=this.placeCenter(l),this.draggableElements[l+1].component.placeAtWithAnim(s[0],s[1],this.timeAnim),l++}null!==a[this.nbPlaces]&&a[this.nbPlaces].cross()}},{"./action":1,"./component":2,"./draggable_element":5,"./utils":7}],4:[function(t,e,i){"use strict";function r(t){var e,i;a(t.paper)&&alert("paper should be defined"),this.paper=t.paper,this.displayHelper=t.displayHelper,this.check=!0,this.keepLastGoodAction=!0,this.containers=[],this.lastDisplayedAction=null,this.lastOver=-1,e=["keepLastGoodAction","canBeTaken","actionIfDropped","drop","actionIfEjected","ejected","over"];for(i in t)t.hasOwnProperty(i)&&!l(i,e)&&(this[i]=t[i]);this.addContainer({ident:"temporaryContainer",cx:-1e3,cy:-1e3,nbPlaces:1,widthPlace:10,heigthPlace:10,direction:"vertical",align:"top",dropMode:"replace",dragDiplayMode:"marker",placeBackgroundArray:null,type:"list"})}var n=t("./action"),o=t("./container"),s=t("./utils"),a=s.isUndefined,l=s.notIn;e.exports=r,r.prototype.addContainer=function(t){var e=o(this,t);return this.containers.push(e),e},r.prototype.removeContainer=function(t){for(var e=0;e<this.containers.length;e++)this.containers[e]===t&&(this.containers[e]=this.containers[this.containers.length-1],this.containers.pop())},r.prototype.getContainer=function(t){if(null===t)return null;for(var e=0;e<this.containers.length;e++){var i=this.containers[e];if(i.ident===t)return i}return null},r.prototype.getObjects=function(t){return this.getContainer(t).getObjects()},r.prototype.insertObject=function(t,e,i){return this.getContainer(t).createAt(e,i.ident,i.elements)},r.prototype.insertObjects=function(t,e,i){for(var r=this.getContainer(t),n=0;n<i.length;n++){var o=i[n];null!==o&&r.createAt(e+n,o.ident,o.elements)}},r.prototype.removeObject=function(t,e){this.getContainer(t).clearPlace(e)},r.prototype.removeAllObjects=function(t){var e=this.getContainer(t);e&&e.clear()},r.prototype.userActionToAction=function(t){var e=this.getContainer(t.dstCont);return n(e,t.dstPos,t.dropType)},r.prototype.getCorrespondingAction=function(t,e,i){for(var r,o=t.container,s=t.iPlace,a=0;a<this.containers.length;a++){var l=this.containers[a];if(l.isInContainer(e,i)){var c=l.getCorrespondingAction(t,e,i);if(null===c)continue;if(r=this.actionIfDropped(o.ident,s,c.dstCont.ident,c.dstPos,c.dropType),"object"==typeof r)return this.userActionToAction(r);if("boolean"==typeof r&&r)return c}}return r=this.actionIfDropped(o.ident,s,null,null,"insert"),"object"==typeof r?this.userActionToAction(r):"boolean"==typeof r&&r?n(null,null,"insert"):this.keepLastGoodAction&&null!==this.lastDisplayedAction?this.lastDisplayedAction:n(o,s,o.dropMode)},r.prototype.hideIndicators=function(){for(var t=0;t<this.containers.length;t++)this.containers[t].hideIndicator()},r.prototype.updateDisplay=function(){for(var t=0;t<this.containers.length;t++)this.containers[t].updateDisplay()},r.prototype.updateIntermediateDisplay=function(t,e,i,r,n){for(var o=0;o<this.containers.length;o++)this.containers[o].updateIntermediateDisplay(t,e,i,r,n)},r.prototype.getElementOver=function(t,e,i){for(var r=0;r<this.containers.length;r++){var n=this.containers[r].getElementOver(t,e,i);if(null!==n)return n}return null},r.prototype.hasBeenTaken=function(t){},r.prototype.hasBeenMoved=function(t,e,i){if(!this.disabled){var r=this.getCorrespondingAction(t,e,i),n=this.getElementOver(t,e,i);this.lastOver!==n&&(this.lastOver=n,null!==this.lastOver?this.over(t.container.ident,t.iPlace,n.container.ident,n.iPlace):this.over(t.container.ident,t.iPlace,null,0)),null!==this.lastDisplayedAction&&r.sameAs(this.lastDisplayedAction)||(this.lastDisplayedAction=r,this.hideIndicators(),null!==r.dstCont&&(r.dstCont.showIndicator(r),t.toFront()),this.updateIntermediateDisplay(t.container,t.iPlace,r.dstCont,r.dstPos,r.dropType))}},r.prototype.hasBeenDropped=function(t,e,i){if(!this.disabled){this.hideIndicators();var r=this.getCorrespondingAction(t,e,i),n=t.container,o=t.iPlace;this.handleDrop(n,o,r.dstCont,r.dstPos,r.dropType),this.lastDisplayedAction=null,this.lastOver=-1}},r.prototype.handleDrop=function(t,e,i,r,n){var o,s=[],a=-1,l=null;for(o=0;o<this.containers.length;o++){var c=this.containers[o];s.push(c.getElementsAfterDrop(t,e,i,r,n)),c===i&&(a=o);var p=s[o][c.nbPlaces];null!==p&&(l={refEl:p,previousCont:c,previousPos:c.nbPlaces-1})}for(a!==-1&&"replace"===n&&null!==s[a][r]&&null!==i.draggableElements[r]&&s[a][r]!==i.draggableElements[r]&&(l={refEl:i.draggableElements[r],previousCont:this.containers[a],previousPos:r}),null===i&&(l={refEl:t.draggableElements[e],previousCont:t,previousPos:e}),o=0;o<this.containers.length;o++)this.containers[o].setObjects(s[o]);this.updateDisplay(),null!==i?this.drop(t.ident,e,i.ident,r,n):this.drop(t.ident,e,null),null!==l&&this.handleEjection(l.refEl,l.previousCont,l.previousPos)},r.prototype.handleEjection=function(t,e,i){var r=this.actionIfEjected(t,e.ident,i);t.show(),null===r?t.remove():(r=this.userActionToAction(r),this.containers[0].draggableElements[0]=t,t.container=this.containers[0],t.iPlace=0,this.handleDrop(this.containers[0],0,r.dstCont,r.dstPos,r.dropType)),this.ejected(t,e.ident,i)},r.prototype.canBeTaken=function(t,e){return!0},r.prototype.actionIfDropped=function(t,e,i,r,n){return!0},r.prototype.disable=function(){this.disabled=!0},r.prototype.drop=function(t,e,i,r,n){},r.prototype.over=function(t,e,i,r){},r.prototype.actionIfEjected=function(t,e,i){return null},r.prototype.ejected=function(t,e,i){}},{"./action":1,"./container":3,"./utils":7}],5:[function(t,e,i){"use strict";function r(t,e,i,r){this.dragAndDropSystem=t.dragAndDropSystem,this.ident=i,this.container=t,this.iPlace=e,this.component=o(r),this.dragState=null,this.crossShape=null;var s=this;n(this.component,t,e,s)}function n(t,e,i,r){var o=e.dragAndDropSystem.displayHelper;t.drag(function(t,e){return r._moveDragCallback(t,e)},function(){return r._startDragCallback()},function(){return t.undrag(),n(t,e,i,r),r._endDragCallback()},o)}var o=t("./component");e.exports=r,r.prototype.remove=function(){this.component.remove()},r.prototype.cross=function(){this.component.halfHide()},r.prototype.show=function(){null!==this.crossShape&&(this.crossShape.remove(),this.crossShape=null),this.component.show()},r.prototype.hide=function(){null!==this.crossShape&&(this.crossShape.remove(),this.crossShape=null),this.component.hide()},r.prototype._startDragCallback=function(){var t=!1;this.dragState&&(t=!0),this.dragAndDropSystem.canBeTaken(this.container.ident,this.iPlace)&&(this.dragState={ox:this.component.cx,oy:this.component.cy,hasReallyMoved:!1,dragNotEnded:t},this.toFront())},r.prototype._moveDragCallback=function(t,e){var i=this.dragState;if(i&&!isNaN(t)&&!isNaN(e)){if(!i.hasReallyMoved){if(Math.abs(t)<=5&&Math.abs(e)<=5)return;this.dragState.hasReallyMoved=!0,this.dragAndDropSystem.hasBeenTaken(this)}this.component.placeAt(i.ox+t,i.oy+e);var r=this.component.cx,n=this.component.cy;this.dragAndDropSystem.hasBeenMoved(this,r,n)}},r.prototype._endDragCallback=function(){var t=this.dragState;if(t)return this.dragState=null,t.hasReallyMoved||t.dragNotEnded?void this.dragAndDropSystem.hasBeenDropped(this,this.component.cx,this.component.cy):void this.component.placeAt(t.ox,t.oy)},r.prototype.placeAt=function(t,e){this.component.placeAt(t,e)},r.prototype.toFront=function(){return this.component.toFront()}},{"./component":2}],6:[function(t,e,i){"use strict";var r=t("./dragAndDropSystem"),n=t("./action");e.exports=window.DragAndDropSystem=function(t){return new r(t)},e.exports.action=n},{"./action":1,"./dragAndDropSystem":4}],7:[function(t,e,i){"use strict";/MSIE\s([\d.]+)/.test(navigator.userAgent)&&(e.exports["ie"+parseInt(RegExp.$1,10)]=!0),e.exports.notIn=function(t,e){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return!1;return!0},e.exports.isUndefined=function(t){return"undefined"==typeof t}},{}]},{},[6]);
//# sourceMappingURL=drag-and-drop.js.map
